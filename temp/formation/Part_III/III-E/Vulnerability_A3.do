
cd "C:\WorldBank\Mauritania\MRT_DATA\"




use "pseudo_matching.dta", clear
count
gen samp_est=1
append using mrt08_14.dta
count
replace samp_est=0 if samp_est==.
replace year=. if samp_est==1
replace new_year=. if samp_est==1


foreach var of varlist version-pl_osh_r {
qui replace new_`var' = `var' if samp_est==0
}
 
gen fw = wta_pop

cap drop cons
gen cons = pcexpdr/177200 /* That of 2014 */
sum cons
cap drop pp
gen pp= (cons<1)


cap drop lcons
gen lcons = ln(cons)

/* new_* are the characteristics in 2008 */
g new_hhagey2 = new_hhagey^2
g new_hhsize2 = new_hhsize^2

forvalues i=1/13 {
gen rega_`i' = (new_region==`i')
 }
 
 
#delimit ;
local mylist

new_hhagey 
new_hhagey2 

new_hhsize
new_hhsize2

new_kids0004 new_kids0509 new_kids1017


new_fao_adq

new_active1564 
new_depend0014 

i.new_hhedlevel
rega_*

i.new_hhmarstat 
new_adfems new_admales

;
 

 
probit pp    `mylist' [pw=fw] if samp_est==1 ;
 local pr2 = e(r2_p);
 predict proba;
 
 *set trace on;
 
 #delimit cr
 regress  lcons `mylist' [aw=fw] if samp_est==1
 local r2 = e(r2)
cap drop plcons
predict plcons, xb

cap drop res
predict res, res

cap drop lres2
gen lres2 = res^2

xi: regress lres2  `mylist'  [aw=fw]  if samp_est==1
cap drop pste2
predict pste2

cap drop lste
gen lste=pste2^0.5

cap drop aa
gen aa=-plcons/lste /* remark that the pline = 1 and log(1)=0*/

cap drop vul
gen vul=normal(aa)
cap drop vp
gen vp=vul>0.5

cap drop vp2
gen vp2=proba>0.5


/* Estimating the vulnerability */
*set trace on
set tracedepth 1
local lnames 2008 2014


preserve
keep if year == 2014
/*keep if samp_est==1 */

sum pp [aw=fw]
local p0_`name'=r(mean)

sum vp [aw=fw]
local mvp_`name'=r(mean)

sum vp2 [aw=fw]
local mvp2_`name'=r(mean)
restore



dis "With : welfare_`name'"
dis "Headcount             : `p0_`name'' "
dis "Vulnerability index 1 : `mvp_`name''  "  " R2 `r2' "
dis "Vulnerability index 2 : `mvp2_`name''  "  " PR2 `pr2' "



