
cd "C:\WorldBank\Mauritania\MRT_DATA\"




use "mrt08_14.dta", clear
gen fw = wta_pop

cap drop cons
gen cons = pcexpdr/177200
sum cons
cap drop pp
gen pp= (cons<1)


cap drop lcons
gen lcons = ln(cons)
g hhagey2 = hhagey^2
g hhsize2 = hhsize^2



forvalues i=1/13 {
gen rega_`i' = (region==`i')
 }
 
 
#delimit ;
local mylist

hhagey 
hhagey2 

hhsize
hhsize2

kids0004 kids0509 kids1017


fao_adq

active1564 
depend0014 

i.hhedlevel
rega_*

i.hhmarstat 
adfems admales

;
 

 
probit pp    `mylist' [pw=fw] ;
 local pr2 = e(r2_p);
 predict proba;
 *set trace on;
 
 #delimit cr
 regress  lcons `mylist' [aw=fw] 
 local r2 = e(r2)
cap drop plcons
predict plcons, xb

cap drop res
predict res, res

cap drop lres2
gen lres2 = res^2

xi: regress lres2  `mylist'  [aw=fw]  
cap drop pste2
predict pste2

cap drop lste
gen lste=pste2^0.5

cap drop aa
gen aa=-plcons/lste /* remark that the pline = 1 and log(1)=0*/

cap drop vul
gen vul=normal(aa)
cap drop vp
gen vp=vul>0.5

cap drop vp2
gen vp2=proba>0.5


/* Estimating the vulnerability */
*set trace on
set tracedepth 1
local lnames 2008 2014
foreach name of local lnames {

preserve
keep if year == `name' 

sum pp [aw=fw]
local p0_`name'=r(mean)

sum vp [aw=fw]
local mvp_`name'=r(mean)

sum vp2 [aw=fw]
local mvp2_`name'=r(mean)
restore
}


foreach name of local lnames {
dis "With : welfare_`name'"
dis "Headcount             : `p0_`name'' "
dis "Vulnerability index 1 : `mvp_`name''  "  " R2 `r2' "
dis "Vulnerability index 2 : `mvp2_`name''  "  " PR2 `pr2' "
}


