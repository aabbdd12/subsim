
cd "C:\WorldBank\Mauritania\MRT_DATA\"


local ylist  2008 2014

foreach name of local ylist {

qui {
use "mrt08_14.dta", clear
keep if year == `name'
dis "Cross - section year =  `name'"
gen fw = wta_pop
cap drop cons
gen cons = pcexpdr/177200
sum cons
cap drop pp
gen pp= (cons<1)
cap drop lcons
gen lcons = ln(cons)
g hhagey2 = hhagey^2
g hhsize2 = hhsize^2
forvalues j=1/13 {
gen rega_`j' = (region==`j')
 }
#delimit ;
local mylist
hhagey 
hhagey2 
hhsize
hhsize2
kids0004 kids0509 kids1017
fao_adq

active1564 
depend0014 

i.hhedlevel
rega_*
i.hhmarstat 
adfems admales

 ;
 
 des hhagey 
hhagey2 
hhsize
hhsize2
kids0004 kids0509 kids1017
fao_adq

active1564 
depend0014 

hhedlevel
region
hhmarstat 
adfems admales

 ;
 };
 sum 
 hhagey 
hhagey2 
hhsize
hhsize2
kids0004 kids0509 kids1017
fao_adq

active1564 
depend0014 

hhedlevel
region
hhmarstat 
adfems admales

 ;
 /*qui {; */
probit pp    `mylist' [pw=fw] ;
 local pr2_`name' = e(r2_p);
 predict proba;
 
 *set trace on;
 
 #delimit cr
 regress  lcons `mylist' [aw=fw] 
 local r2_`name' = e(r2)
cap drop plcons
predict plcons, xb

cap drop res
predict res, res

cap drop lres2
gen lres2 = res^2

xi: regress lres2  `mylist'  [aw=fw]  
cap drop pste2
predict pste2

cap drop lste
gen lste=pste2^0.5

cap drop aa
gen aa=-plcons/lste /* remark that the pline = 1 and log(1)=0*/

cap drop vul
gen vul=normal(aa)
cap drop vp
gen vp=vul>0.5

cap drop vp2
gen vp2=proba>0.5


set tracedepth 1

sum pp [aw=fw]
local p0_`name'=r(mean)

sum vp [aw=fw]
local mvp_`name'=r(mean)

sum vp2 [aw=fw]
local mvp2_`name'=r(mean)
dis "************ `name' *************"
tab pp vp [aw=fw], cell nofreq
tab pp vp2 [aw=fw], cell nofreq
/*}*/

}

foreach name of local ylist {
dis "With : welfare_`name'"
dis "Headcount             : `p0_`name'' "
dis "Vulnerability index 1 : `mvp_`name''  "  " R2 `r2_`name'' "
dis "Vulnerability index 2 : `mvp2_`name''  "  " PR2 `pr2_`name'' "

}
